<!DOCTYPE html>
<html>

<head>
	<title>Recommend Unit</title>
	<link rel="stylesheet" href="styles.css">
	<script src="grid.js"></script>
	<script src="renderer.js"></script>
	<script src="unit_data.js"></script>
	<script src="grid_data.js"></script>
	<script src="units.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
		crossorigin="anonymous"></script>
</head>

<script>
	//Runs when button clicked
	function initTool() {
		window.grid = generateGrid()
		window.units = generateUnits()
		render()
	}
	// Runs on page load
	window.onload = (event) => {
		document.querySelectorAll("#filter-controls input[type=radio]").forEach(e => {
			e.addEventListener("change", (event) => handleFilterChange(event))
		})
	}

</script>

<body>
	<div class="container">
		<div class="row pt-4">
			<div class="col">
				<div class="d-flex pb-2" id="filter-controls">
					<span class="me-3">Other Options:</span>
					<div style="padding-right: 10px; margin-right: 10px; border-right: 1px solid black;">
						<input type="radio" id="available" name="filter" value="available" checked>
						<label for="available">Use Available Units Only</label>
					</div>
					<div>
						<input type="radio" id="all" name="filter" value="all">
						<label for="all">Use All Units</label>
					</div>
				</div>

				<!-- RCU Table -->
				<table id="unitTable" class="table table-bordered border border-black">
					<thead>
						<tr>
							<th>
								<FONT COLOR=black>Unit
							</th>
							<th>
								<FONT COLOR=black>Type
							</th>
							<th>
								<FONT COLOR=black>DW
							</th>
							<th>
								<FONT COLOR=black>Status
							</th>
							<th>
								<FONT COLOR=black>Distance
							</th>
						</tr>
					</thead>
					<tbody id="unit-table-body">
						<!-- This is the tabel body that doesnt have anything in it-->
					</tbody>
				</table>
				<!-- PRINT A RANDOMISED GRID -->
				<span id="randomEventType"></span>
				<div class="d-flex">
				<span class="me-2 fw-bold">Grid:</span>
				<p id="randomGrid"></p>
				</div>
				
			</div>
			<div class="col">
				<!-- BUTTONS -->
				<button onclick="initTool()" style="display: inline-block; margin-right: 20px;">NEW EVENT</button>
				<button onclick="refDmESO()">ESO</button>
				<button onclick="refDmNNU()">NNU</button>
				<button onclick="clearAll()">Clear Remarks</button>
				<p></p>
				<!-- REMARKS -->
				<select id="comment-select" onchange=addComment()>
					<option value="">Remarks...</option>
					<option value="==REFER TO DM - CLOSER CAR PRI 0==">==REFER TO DM - CLOSER CAR PRI 0==</option>
					<option value="==REFER TO DM - >20km==">==REFER TO DM - >20km==</option>
					<option value="==REFER TO DM FOR BACKUP SOLUTION==">==REFER TO DM FOR BACKUP SOLUTION==</option>
				</select>
				<ul id="comment-list"></ul>
				<hr>
				<p> </p>
			</div>
		</div>
	</div>
	<p>Please report any issues/Requests to Marcus - Happy Studying :)</p>

	<!-- MAIN SCRIPTING TO RUN FUCTIONS -->
	<script>
		// Event Listening: Detects key to regenerate RCU string
		document.addEventListener("keydown", function (event) {
			// check if Enter key is pressed
			if (event.key === "Enter") {
				// trigger click event on button
				generateTable();
			}
		});

		// CSV Import Function to import a new unit list
		function handleCSVFile() {
			const file = document.getElementById('csv-input').files[0];
			const reader = new FileReader();
			reader.readAsText(file);
			reader.onload = function () {
				const contents = reader.result;
				const lines = contents.split('\n');
				const newUnits = lines.map(line => line.trim());
				units = newUnits;
				generate();
			}
		}

		//Canned Comment Remarks
		function addComment() {
			var comment = document.getElementById("comment-select").value;
			var node = document.createElement("LI");
			var textnode = document.createTextNode(comment);
			node.appendChild(textnode);
			document.getElementById("comment-list").appendChild(node);
			document.getElementById("comment-select").selectedIndex = 0;
		}

		function refDmESO() {
			var comment = "ESO Button Hit";
			var node = document.createElement("LI");
			var textnode = document.createTextNode(comment);
			node.appendChild(textnode);
			document.getElementById("comment-list").appendChild(node);
			document.getElementById("comment-select").selectedIndex = 0;
		}

		function refDmNNU() {
			var comment = "NO NEARBY UNITS FOR THIS EVENT";
			var node = document.createElement("LI");
			var textnode = document.createTextNode(comment);
			node.appendChild(textnode);
			document.getElementById("comment-list").appendChild(node);
			document.getElementById("comment-select").selectedIndex = 0;
		}


		//Clear Remarks
		function clearAll() {
			document.getElementById("comment-list").innerHTML = "";
		}
		// list of units


		//Generates table


		function shuffle(array) {
			// Fisher-Yates shuffle algorithm
			for (var i = array.length - 1; i > 0; i--) {
				var j = Math.floor(Math.random() * (i + 1));
				var temp = array[i];
				array[i] = array[j];
				array[j] = temp;
			}
			return array;
		}

	</script>
</body>

</html>